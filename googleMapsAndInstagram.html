<!DOCTYPE html>
<html>
  <head>
    <title>Google Maps and Instagram</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script src="http://cooper-union-maps-proxy.herokuapp.com/js/draw.js"></script>
    <script>

      var map;
      var initialize = function(){
        var mapOptions = {
          zoom: 2,
          center: new google.maps.LatLng(40.7032088,-74.0144847)
        };

        map = new google.maps.Map(document.getElementById('map'),
            mapOptions);
      }

      google.maps.event.addDomListener(window, 'load', initialize);

      function changeSite(){
        //alternate between day and night
        if (site === site1){
          site = site2;
        }
        else {
          site = site1;
        }
      }

      //store all the markers
      var listOfMarkers = [];
      var listOfInfoWindows = [];

      //find where people are waking up and where they are sleeping
      var site1 = "http://cooper-union-instagram-proxy.herokuapp.com/search/tag/goodmorning?count=100";
      var site2 = "http://cooper-union-instagram-proxy.herokuapp.com/search/tag/goodnight?count=100";

      var site = site1;

      //Add markers to the site
      $.getJSON(site, function(response){
        //loop through the responses and find the ones with location
          for (var i = 0; i < response.length; i++){
            if (response[i].location != null){
              console.log("not null location")
              var lat = response[i].location.latitude;
              var long = response[i].location.longitude;
              var location = new google.maps.LatLng(lat,long);
              var marker = new google.maps.Marker({
                title: response[i].caption.text,
                position: location,
                map: map,
                //'link': response[i].link,
                //'html': '<img src='+response[i].images.thumbnail.url+' />',
                icon: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png'
              });
              var template = '<div class="content">'+'<img src='+response[i].images.thumbnail.url+' />'+'<a href='+response[i].link+'>'+response[i].title+'</a></div>';
              //var win = template.replace('{{content}}', response[i].title);
              //win = template.replace('{{link}}', response[i].link);
              //win = template.replace('{{html}}', '<img src='+response[i].images.thumbnail.url+' />');

              var infowindow = new google.maps.InfoWindow({
                content: template,
                maxWidth: 200
              });

              // google.maps.event.addListener(marker, 'click',
              //     function(event)
              //     {
              //         //map.panTo(event.latLng);
              //         //map.setZoom(5);
              //         infowindow.open(map, this);
              //     }
              // );
              marker.addListener('click', function() {
                infowindow.open(map, this);
              });

              listOfMarkers.push(marker);
              listOfInfoWindows.push(infowindow);

              // google.maps.event.addListener(marker, 'click', function() {
              //         this.infowindow.open(map, this);
              // });

              //marker.setIcon('http://maps.google.com/mapfiles/ms/icons/green-dot.png');

            }
          }
          console.log(listOfMarkers);
      });

      function changeSite(){
        console.log(site);
        //alternate between day and night
        if (site === site1){
          site = site2;
        }
        else {
          site = site1;
        }
      }

      function clearMarkers() {
        for (var i = 0; i < listOfMarkers.length; i++) {
          listOfMarkers[i].setMap(null);
        }
        listOfMarkers = [];
      }

      // setInterval(function(){
      //   changeSite();
      //   clearMarkers();
      // },5000);

        /*
        var intervalIndex = 0;
        var intervalFunctions = [initialize(site2),initialize(site1)];
        setInterval(function(){
          // var index = intervalIndex++ % intervalFunctions.length;
          var index = intervalIndex++ % 2 + 1;
          console.log(index);
          //intervalFunctions[index];
          var site = "site" + index.toString();
          initialize(site);
        },5000);
        */

        // $("<img>").attr("src",response[0].images.thumbnail.url).appendTo("body");


    </script>
        <style>
      #map {
        height:800px;
        /*width:800px;*/
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
  </body>
</html>
